var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var a=0;return function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+a++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();$jscomp.initSymbol();$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
var emailEl=_("email"),subEl=_("sub"),submitEl=_("submit"),feedback=_("submit-feedback"),apiDomain="https://api.nan.ci",reject=function(a){return Promise.reject(a)},toJSON=function(a){return 200!==a.status?a.json().then(reject):a.json()},headers={Accept:"application/json, text/plain, */*","Content-Type":"application/json"},api=function(a){return function(b){return function(c){return fetch(apiDomain+"/"+b,{body:JSON.stringify(c),headers:headers,method:a}).then(toJSON)}}},levenshtein=function(a,b){if(0===
a.length)return b.length;if(0===b.length)return a.length;var c;if(a.length>b.length){var d=a;a=b;b=d}var e=Array(a.length+1);for(d=0;d<=a.length;d++)e[d]=d;for(d=1;d<=b.length;d++){var f=d;for(c=1;c<=a.length;c++){var g=b[d-1]===a[c-1]?e[c-1]:Math.min(e[c-1]+1,Math.min(f+1,e[c]+1));e[c-1]=f;f=g}e[a.length]=f}return e[a.length]},whitelist=[],blacklist=new Set;
fetch("/assets/misc/domain-list.txt").then(function(a){return a.text()}).then(function(a){return a.split("#disposable#").map(function(a){return a.split("\n")})}).then(function(a){var b=$jscomp.makeIterator(a);a=b.next().value;b=b.next().value;whitelist=a.filter(Boolean).map(function(a){return{value:a,score:0}});blacklist=new Set(b.filter(Boolean))});
var byScore=function(a,b){return a.score-b.score},findNearestPopularDomain=function(a){if(!a)return{score:0,value:""};whitelist.forEach(function(b){return b.score=levenshtein(a,b.value)});return whitelist.sort(byScore)[0]};api.email=api("POST")("email");var say=function(a){feedback.classList.remove("error");feedback.textContent=a},sayError=function(a){feedback.classList.add("error");feedback.textContent=a},preventSubmit=!1;emailEl.onfocus=function(){return preventSubmit=!1};
var isInputValid=function(a){var b=$jscomp.makeIterator(emailEl.value.split(/(^[^@]+@)(.+)/));b.next();var c=b.next().value;b=b.next().value;if(!b)return sayError("Email invalide");if(blacklist.has(b))return sayError("@"+b+" est bloqu\u00e9");if(a)return!0;a=findNearestPopularDomain(b);return b!==a.value&&5>a.score?say("c'est pas plut\u00f4t "+c+a.value+" ?"):!0};emailEl.onchange=function(){preventSubmit=!0;if(!isInputValid())return emailEl.select();say("");preventSubmit=!1};
submitEl.onclick=function(){if(preventSubmit||submitEl.classList.contains("wait"))return!1;if(!isInputValid(!0))return emailEl.select();say("verification...");submitEl.classList.add("wait");api.email({email:emailEl.value,sub:subEl.checked}).then(function(){return window.location.pathname="/blog"},function(a){sayError(a.message);emailEl.select();submitEl.classList.remove("wait")});return!1};say("");
